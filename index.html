<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Chat App</title>
	<!-- <link rel="icon" href="C:/Users/S4/Downloads/touchscreen_book_bookmark_ebook_icon_191190.ico">  -->
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
</head>
<!-- Mqtt paho.js file path -->
<script src="D:Today\MQTT Web Project\paho.javascript-1.0.3\paho-mqtt.js" type="text/javascript"></script>

<script type="text/javascript">
	var client;
	document.getElementById("broker_div").style.display = "none";
	//document.getElementById("topics_div").style.display = "none";
	document.getElementById("cb_config").checked = true;
	function Host() {

		var host = document.getElementById("txt_Host").value;
		var port = document.getElementById("txt_Port").value;
		var clientID = document.getElementById("txt_CLient").value;

		//var host = document.form("txt_Host").value;

		client = new Paho.MQTT.Client(host, Number(port), clientID);

		// set callback handlers
		client.onMessageArrived = onMessageArrived;


		// connect the client
		client.reconnect = true;
		client.connect({onSuccess: onConnect, userName: "Marlon", password: "MarlonD1"});
	}
	//Triggered when connecting to broker
	function onConnect() {
    	// Once a connection has been made, make a subscription and send a message.
    	var topic = document.getElementById("txt_Subscribe").value;
    	console.log("Connected");
    	client.subscribe(topic);//subscribe to Topic. 
    	alert("Connected to broker and subscribed to Topic: " + topic);
		
	}

//Triggered when a message has arrived
	function onMessageArrived(message) {
    	console.log("onMessageArrived:"+message.destinationName + " " + message.payloadString);
    	var text = message.destinationName + ": " + message.payloadString + "\n";
     	//const data = JSON.parse(message.payloadString);
     	document.getElementById("texta_DisplayMessage").value +=  text;
    }
//Triggered when a message has arrivedTriggered when a message is sent.
    function publishMessage() {
    	var pub_Topic = document.getElementById("txt_Publish").value;
		var input = document.getElementById("texta_Message").value;
		var text = pub_Topic + ": " + input + "\n";
		message = new Paho.MQTT.Message(input);
		message.destinationName = pub_Topic;
		client.send(message);
		console.log("message sent");
		document.getElementById("texta_DisplayMessage").value += text;
		document.getElementById("texta_Message").value =" ";
	}
	function disconnect() {
		client.disconnect = true;
	}
	// Hide or show Settings DIV
	function hide() {
		cb = document.getElementById("cb_config");
		if (cb.checked === true) {
			document.getElementById("broker_div").style.display = "block";
			//document.getElementById("topics_div").style.display = "block";
		}
		else {
			document.getElementById("broker_div").style.display = "none";
			//document.getElementById("topics_div").style.display = "none";
		}
	}
</script>

<body on>
	<navbar class="navbar-expand navbar-exapand-lg bg-dark navbar-dark">
		<div  class="container">
			<h1>Chat App</h1>
			<div class="collapse navbar-collapse">
				
			</div>
		</div>
	</navbar>



<form action="" id="form_Broker">
<div  class="container-fluid border-bottom" id="config_div">
	<input  type="checkbox"  checked="false" name="cb_config" id="cb_config" value="Configure" onclick="hide()">
	<label for="cb_config">Configure Broker:</label></br>
</div>
	<!-- Settings Div -->
	<div  class="container-fluid border-bottom" id="broker_div"></br>
		<h2>Broker Settings</h2></br>

		<label class="px-1">Host:</label>
		<input type="text" class="form-control form-control-sm" name="txt_Host" id="txt_Host">
		<label class="px-1">Port:</label>
		<input  type="text" class="form-control form-control-sm" name="txt_Port" id="txt_Port">
		<label class="px-1">Client ID:</label>
		<input type="text" class="form-control form-control-sm" name="txt_CLient" id="txt_CLient">
		<label class="px-1">Subscribe Topic:</label>
		<input type="text" class="form-control form-control-sm" name="txt_Subscribe" id="txt_Subscribe"></br></br>
		<input type="button" name="sub_config" id="sub_config" value="Submit" onclick="Host()"></br></br>

	</div>
</form>


</form>

<form>

	<div class="container-fluid"></br>
		<label class="px-0">Publish Topic:</label>
		<input type="text" class="form-control form-control-sm" name="txt_Publish" id="txt_Publish"></br>
		<label>Enter Message:</label></br>
		<textarea id="texta_Message" name="texta_Message" rows="4" cols="50" wrap="soft"></textarea></br></br>
		<textarea id="texta_DisplayMessage" name="texta_DisplayMessage" rows="30" cols="50" wrap="soft" readonly></textarea></br></br>
		<input type="button" name="btn_Send" id="btn_Send" value="Send Message" onclick="publishMessage()">
		<input type="button" name="btn_Disconnect" id="btn_Disconnect" value="Disconnect" onclick="disconnect()"></br>
	</div></br>

</form>

</body>
</html>